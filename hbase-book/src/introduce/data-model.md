## 数据模型
HBase 是一个 K-V 型的数据库，从逻辑视图上看数据是以表的形式进行组织的，并且和关系型数据库一样表也由行和列组成；从物理视图来看，HBase 是一个 稀疏的、分布式的、多维有序的 Map。

### 逻辑视图

逻辑视图是从用户的角度来考虑，HBase 提供了和关系型数据库类似的功能以及术语：

- **命名空间(Namespace)**：命名空间是表的逻辑分组，类似于关系型数据库中的数据库。在创建表的时候使用 ```<table_namespace>:<table_name>``` 指定表的命名空间。系统预置了两个命名空间：hbase 是系统命名空间，包含 HBase 内部的表；default 是默认的命名空间，没有显式指定命名空间的表会自动的分组到这个命名空间
- **表(Table)**：HBase 的 Table 是由多个 Row 组成。HBase 中的每个表都有自己的目录，位于 HBase 根目录(/hbase)下，每个表目录包含一个名为 .tableInfo 的顶层文件，该文件保存了该表的元数据信息，在插入数据之前需要先创建表
- **行(Row)**：行由行键 (row key) 以及多个具有值的列 (column) 组成，HBase 表中的行按照行键的字典顺序存储，因此在设计行键时尽量使相似的行相邻
- **列(Column)**：列由列族 (column family) 和列限定符 (column qualifier) 组成，列族和列限定符由 ：(冒号)分隔
- **列族(Column Family)**：列族在物理上通常出于性能原因将一组列及其值合并在一起。列族在表创建的时候需要指定，一个列族可以设置任意多个列限定符，即一个列族可以包含任意多个列
- **列限定符(Column Qualifier)**：列限定符用于定位列族中的指定列，列族需要在创建表的时候指定，但是列限定符可以任意添加
- **单元格(Cell)**：Cell 是由五元组 (row, column, timestamp, value) 组成的结构，其中 type 表示操作类型(PUT/DELETE)，timestamp 表示值的版本
- **时间戳(Timestamp)**：时间戳是写入值的版本标识，每个值在写入的时候都伴随着一个时间戳。默认情况下，时间戳是写入数据时 RegionServer 上的时间，在 Put 数据的时候可以指定时间戳

```
// 
+--------+---------------+---------------+-----------+
|        |       cf1     |      cf2      |           |
| rowkey +---------------+---------------+ Timestamp |
|        |  c1  |   c2   |  c1  |   c2   |           |
+--------+------+--------+------+--------+-----------+
|   r1   |  v1  |        |  v1  |   v2   |     t1    |
+--------+------+--------+------+--------+-----------+
|   r1   |      |    v1  |  v1  |        |     t2    |
+--------+------+--------+------+--------+-----------+
|   r1   |      |        |  v1  |        |     t3    |
+--------+------+--------+------+--------+-----------+
```

从逻辑视图可以将 HBase 的数据存储看作一张表，表中空的 cell 不会占用空间，因此整个表非常的稀疏。



### 物理视图

物理视图是从 HBase 的实现来考虑，HBase 基于列簇存储，属于同一列簇的数据存储在一起。

### 

### 版本(Versions)

HBase 中的数据具有版本，每个 cell 由 (row, column, version) 确定，即使具有相同的 row 和 column 也可以通过改变版本来定义不同的 cell。

行和列键表示为字节，而版本则使用长整数指定，默认是时间戳。HBase 的数据是按照 vesion 降序存储的，所以在读取数据的时候读到的都是最新版本的数据。

当向同一个版本的 cell 写入多个数据时，最后写入的数据是可读的(覆盖了之前的写)；cell 的版本可以不是递增的。

列存储的最大版本数在创建表的时候就需要指定，在 HBase 0.96 之前默认最大版本数为 3，之后更改为 1。可以通过 alter 命令或者 HColumnDescriptor.DEFAULT_VERSIONS 来修改。

```shell
# 设置 t1 表的 f1 列族的最大存储版本为 5
alter 't1', Name=>'f1', VERSIONS=>5
```

也可以指定列族的最小存储版本，默认是 0 即该功能不启用：

```shell
# 设置 t1 表的 f1 列族的最小存储版本为 2
alter 't1', NAME=>'f1', MIN_VERSIONS=>2
```
