### 二阶段提交(2PC)

二阶段提交以事务提交的方式保证数据的一致性，在二阶段提交中发起事务的节点称为 "协调者"，执行事务的节点称为 "参与者"，整个事务提交的过程分为两个阶段，因此称为二阶段提交(Two-Phrase Commit)。

请求阶段：

- 协调者向所有参与者发起事务请求，然后阻塞等待参与者的响应；
- 参与者执行本地事务，如果执行成功则返回成功，否则返回失败

提交阶段：

- 协调者接收到了参与者返回失败的消息或者超时仍未收到所有参与者的消息则向所有参与者发送回滚消息，否则发送提交消息
- 参与者接收到了回滚消息后回滚事务并释放再执行事务时的锁资源，如果接收到提交消息则执行事务提交并释放锁定的资源
- 所有参与者在返回事务提交或者回滚完成消息后整个事务完成

二阶段提交的问题：

- 同步阻塞问题：执行过程中所有节点都是事务阻塞的
- 单点问题：协调者发生故障时，参与者会一直阻塞下去
- 数据不一致问题：发生网络分区时只有部分参与者接受到 commit 请求后提交事务，其他参与者不能提交事务





https://www.cnblogs.com/stateis0/p/9062126.html

https://www.cnblogs.com/soundcode/p/5590710.html